Story 1.3: 构建AI识别与故事生成的后端服务StatusDraftStory作为一个 开发者，我想要 创建一个Cloudflare Worker无服务器函数，它能接收图片、调用AI API并返回故事，以便于 为前端提供核心的智能处理能力。Acceptance Criteria成功创建一个新的Cloudflare Worker并通过Wrangler或Cloudflare仪表板部署。该Worker暴露一个可以通过 POST 请求访问的HTTP端点（URL应作为环境变量传递给前端）。该端点能够正确接收通过 multipart/form-data 格式上传的图片数据。Worker能够从环境变量中安全地读取 Gemini API 密钥 (GEMINI_API_KEY)。Worker能够成功调用 Google AI Gemini 1.5 Pro API，向其发送接收到的图片数据。Worker能够解析 Gemini API 返回的响应，提取出识别的物品英文名称和生成的故事文本。该端点最终以 application/json 格式，返回一个包含 { "word": "string", "story": "string" } 结构的对象。如果AI调用失败或发生任何内部错误，端点必须返回一个 status >= 400 的错误响应，并在响应体中包含 { "error": "string" } 信息。该Worker可以通过外部工具（如 Postman 或 curl）发送图片进行成功测试，并返回预期的JSON响应或错误响应。Tasks / Subtasks[ ] Task 1: 初始化 Cloudflare Worker 项目 (AC: 1)[ ] 使用 Wrangler CLI 创建一个新的 Worker 项目（建议使用 TypeScript 模板）。[ ] 配置 wrangler.toml 文件，设置 Worker 名称等基本信息。[ ] Task 2: 实现图片接收逻辑 (AC: 3)[ ] 编写代码处理 POST 请求。[ ] 使用 request.formData() 解析 multipart/form-data 请求体，提取名为 image 的文件数据。[ ] 处理未上传图片或格式错误的情况，返回 400 错误 (AC: 8)。[ ] Task 3: 配置并安全读取 API 密钥 (AC: 4)[ ] 在 Cloudflare Worker 的设置中（通过仪表板或 wrangler secret put 命令）添加名为 GEMINI_API_KEY 的 Secret。[ ] 在 Worker 代码中，确保能从环境变量 env.GEMINI_API_KEY 中正确读取密钥。[ ] Task 4: 实现对 Gemini API 的调用 (AC: 5, 6)[ ] 使用 fetch API 向 Google AI Gemini API (多模态端点) 发送请求。[ ] 构造正确的请求体，包含图像数据和相应的 Prompt（例如：“请识别这张图片里的主要物品，返回它的英文单词，并创作一个适合3岁儿童的、一到两句话的英文小故事。”）。[ ] 在请求头中包含 API 密钥。[ ] 处理 Gemini API 可能返回的错误（例如，内容安全过滤、API限流等），返回 500 或相应的错误状态码 (AC: 8)。[ ] 解析 Gemini API 的成功响应，提取所需的 word 和 story 字段。[ ] Task 5: 构建并返回响应 (AC: 7, 8)[ ] 对于成功情况，构造 { "word": "...", "story": "..." } JSON 对象，并以 200 OK 状态返回。[ ] 对于任何处理过程中的失败（图片解析失败、AI调用失败、响应解析失败等），构造 { "error": "描述性错误信息" } JSON 对象，并返回相应的错误状态码（如 400, 500, 502 等）。[ ] Task 6: 部署 Worker (AC: 1)[ ] 使用 wrangler deploy 命令将 Worker 部署到 Cloudflare。[ ] Task 7: 编写基础单元/集成测试 (AC: 9)[ ] 使用 vitest 或类似工具为 Worker 编写测试。[ ] 至少覆盖：成功处理请求、图片格式错误、Gemini API 调用失败这三种场景。[ ] （可选，但推荐）使用 Miniflare 在本地模拟 Cloudflare 环境进行集成测试。[ ] Task 8: 使用外部工具进行端到端测试 (AC: 9)[ ] 使用 Postman 或 curl 向已部署的 Worker URL 发送一个真实的图片 POST 请求。[ ] 验证是否能收到包含 word 和 story 的 JSON 响应。[ ] 测试发送无效请求（例如，没有图片）时，是否能收到预期的错误响应。Dev Notes核心技术栈:平台: Cloudflare Workers语言: TypeScript构建/部署: Wrangler CLI[Source: PRD#第四部分, Frontend Architecture Document#第十部分]API 集成:目标: Google AI Gemini 1.5 Pro (多模态端点)。认证: API Key，通过 Cloudflare Secrets 管理 (env.GEMINI_API_KEY)。Prompt 建议: "请识别这张图片里的主要物品，返回它的英文单词，并创作一个适合3岁儿童的、一到两句话的英文小故事。" （可根据需要调整）错误处理: 必须捕获来自 Gemini API 的错误并将其转化为对前端友好的错误响应。[Source: PRD#第四部分]数据格式:入: multipart/form-data，包含一个名为 image 的文件字段。出 (成功): application/json，格式为 { "word": "string", "story": "string" }。出 (失败): application/json，格式为 { "error": "string" }，状态码 >= 400。[Source: Frontend Architecture Document#第六部分 (推断)]项目结构:使用 Wrangler CLI 生成的标准 Worker 项目结构。建议将 Gemini API 调用逻辑封装在一个单独的函数或模块中。[Source: Cloudflare Workers Docs]测试:需要编写单元测试覆盖核心逻辑。需要使用外部工具（Postman/curl）进行手动端到端验证。[Source: PRD#第四部分, Frontend Architecture Document#第九部分]第6步：故事草稿自检类别状态问题1. 目标与背景清晰度PASS无2. 技术实现指导PASS无3. 参考资料有效性PASS无4. 自包含评估PASS无5. 测试指导PASS无最终评估: 准备就绪 (READY)。这个故事为开发者提供了清晰的目标、详细的任务、充分的技术上下文和明确的验收标准，可以直接进入开发。